# Search Auto-Complete Issue Templates

These templates are used by the multi-repo orchestration skill to spawn issues in dependent repositories.

---

## Template 1: Backend API (octocat-supply-api)

### Title
```
[octocat-supply-platform#<ISSUE_NUMBER>] Implement Search Auto-Complete API Endpoint
```

### Body
```markdown
## Parent Issue
This task was spawned from copilot-skills-example/octocat-supply-platform#<ISSUE_NUMBER>

## Task Description
Implement a search auto-complete API endpoint that provides real-time suggestions for Products, Suppliers, and Orders as users type.

## Requirements

### 1. API Endpoint
Create `GET /api/search/suggestions` with the following specifications:

**Query Parameters:**
- `q` (required, string): Search query (minimum 3 characters)
- `entity` (optional, string): Filter by entity type - "products", "suppliers", "orders" (default: all)
- `limit` (optional, number): Maximum results to return (default: 10, max: 20)

**Response Format:**
```json
{
  "query": "widget",
  "suggestions": [
    {
      "type": "product",
      "id": 5,
      "text": "Widget A",
      "subtext": "SKU: WDG-001 | $29.99",
      "metadata": {
        "price": 29.99,
        "sku": "WDG-001"
      }
    },
    {
      "type": "supplier",
      "id": 2,
      "text": "Widget Supplier Inc.",
      "subtext": "john@widget.com"
    }
  ]
}
```

### 2. Search Algorithm
- Implement case-insensitive fuzzy matching using LIKE queries
- Search across:
  - **Products:** name, sku
  - **Suppliers:** name
  - **Orders:** name
- Order results by relevance:
  1. Exact matches first
  2. Starts with query
  3. Contains query
- Balance results across entity types when searching all

### 3. Database Optimization
Add indexes for search performance:
```sql
CREATE INDEX IF NOT EXISTS idx_products_name ON products(name);
CREATE INDEX IF NOT EXISTS idx_products_sku ON products(sku);
CREATE INDEX IF NOT EXISTS idx_suppliers_name ON suppliers(name);
CREATE INDEX IF NOT EXISTS idx_orders_name ON orders(name);
```

Create a new migration file for these indexes.

### 4. Validation
- Return 400 Bad Request if query < 3 characters
- Return 400 Bad Request if invalid entity type specified
- Return 400 Bad Request if limit exceeds maximum (20)
- Return 200 OK with empty array if no results found

### 5. Swagger Documentation
Update `api-swagger.json` to document:
- Endpoint path and method
- Query parameters with types and validation rules
- Response schema with example
- Error responses (400, 500)

### 6. Testing
Add integration tests covering:
- Valid query returns suggestions
- Query too short returns 400 error
- Entity filtering works correctly
- Limit parameter is enforced
- Case-insensitive matching works
- Empty results handled gracefully
- Products found by name and SKU
- Suppliers found by name
- Orders found by name

## Performance Targets
- Response time < 100ms for typical queries
- Efficient use of database indexes
- No N+1 query issues

## Architecture Context

### OctoCAT Entity Model
**Entities:** Supplier, Product, Order, OrderDetail, Delivery, OrderDetailDelivery, Headquarters, Branch

**Relevant Fields:**
- **Product:** productId, name, sku, price, description, supplierId
- **Supplier:** supplierId, name, email, contactPerson
- **Order:** orderId, name, orderDate, status, branchId

### Naming Convention
- TypeScript: camelCase (e.g., `productId`, `orderDate`)
- Database: snake_case (e.g., `product_id`, `order_date`)
- Repository pattern for data access

## Integration Notes
- **Depends on:** None (standalone API endpoint)
- **Provides:** Search suggestions API for frontend auto-complete component
- **Integrates with:** octocat-supply-web will consume this endpoint via React Query

## Acceptance Criteria
- [ ] GET /api/search/suggestions endpoint implemented
- [ ] Database indexes added via migration
- [ ] Swagger documentation updated
- [ ] All validation rules enforced
- [ ] Integration tests passing
- [ ] Response time < 100ms verified
- [ ] Repository pattern followed

## Reference Documentation
- Full specification: `/specs/features/search-autocomplete-page.md` (Phase 1)
- Orchestration plan: `/specs/features/search-autocomplete-orchestration-plan.md`
- Entity model: `/architecture/entity-model.md`

---
*Auto-generated by Copilot multi-repo orchestration*
```

---

## Template 2: Frontend UI (octocat-supply-web)

### Title
```
[octocat-supply-platform#<ISSUE_NUMBER>] Implement Search Auto-Complete UI Component
```

### Body
```markdown
## Parent Issue
This task was spawned from copilot-skills-example/octocat-supply-platform#<ISSUE_NUMBER>

## Task Description
Implement a search auto-complete UI component that provides real-time suggestions as users type, with keyboard navigation and accessibility support.

## Requirements

### 1. SearchAutoComplete Component
Create `src/components/SearchAutoComplete.tsx` with:

**Features:**
- Search input with icon
- Debounced API calls (300ms delay)
- Minimum 3 characters before triggering search
- Suggestions dropdown with results
- Loading state indicator
- Empty state message ("No results found")
- Keyboard navigation (Arrow Up/Down, Enter, Escape)
- Mouse interaction (hover, click)
- Accessibility (ARIA attributes, screen reader support)

**TypeScript Interface:**
```typescript
interface Suggestion {
  type: 'product' | 'supplier' | 'order';
  id: number;
  text: string;
  subtext?: string;
  metadata?: Record<string, any>;
}

interface SearchAutoCompleteProps {
  placeholder?: string;
  onSelect?: (suggestion: Suggestion) => void;
  className?: string;
}
```

### 2. Suggestion Display
Each suggestion should show:
- Type indicator icon (Product üè∑Ô∏è, Supplier üè¢, Order üì¶)
- Primary text (name/title) in bold
- Secondary text (SKU, contact info, order number) in muted color
- Hover effect with background highlight
- Selected state for keyboard navigation

### 3. API Integration
Use React Query to call `GET /api/search/suggestions`:
```typescript
const { data, isLoading } = useQuery({
  queryKey: ['search', query],
  queryFn: () => fetchSuggestions(query),
  enabled: query.length >= 3,
  staleTime: 5 * 60 * 1000, // 5 minutes
  keepPreviousData: true
});
```

### 4. Navigation Integration
Update navigation component(s) to include SearchAutoComplete:
- Desktop: Full-width search bar in header
- Mobile: Collapsible search with icon button
- Maintain existing theme (dark mode) support

### 5. Selection Behavior
On suggestion selection:
- Product ‚Üí Navigate to `/products/:id`
- Supplier ‚Üí Navigate to `/suppliers/:id`
- Order ‚Üí Navigate to `/orders/:id`
- Clear search input
- Close dropdown

### 6. Keyboard Navigation
- **Arrow Down:** Move to next suggestion (wrap to first if at end)
- **Arrow Up:** Move to previous suggestion (wrap to last if at start)
- **Enter:** Select highlighted suggestion and navigate
- **Escape:** Close dropdown and clear focus
- **Tab:** Move focus out of component

### 7. Accessibility Requirements
- `role="combobox"` on input element
- `role="listbox"` on suggestions container
- `role="option"` on each suggestion
- `aria-expanded` state management
- `aria-activedescendant` for keyboard focus
- Proper label association
- Keyboard focus indicators visible
- Screen reader announcements for result counts
- Color contrast ratio >= 4.5:1

### 8. Styling
- Tailwind CSS utility classes
- Consistent with existing design system
- Dark mode support via ThemeContext
- Responsive design:
  - Mobile (<640px): Collapsible search
  - Tablet (768px): Compact search bar
  - Desktop (>1024px): Full-width search
- Smooth animations for dropdown (fade-in, slide-down)
- Proper z-index layering

### 9. Performance
- Debounce user input (300ms)
- Cancel previous API requests when new query starts
- Optimize re-renders with React.memo for suggestion items
- Lazy load component if not immediately needed

## Architecture Context

### OctoCAT Entity Model
**Entities:** Supplier, Product, Order, OrderDetail, Delivery, OrderDetailDelivery, Headquarters, Branch

**API Endpoint:**
```
GET /api/search/suggestions?q=<query>&limit=10
```

**Response Format:**
```json
{
  "query": "widget",
  "suggestions": [
    {
      "type": "product",
      "id": 5,
      "text": "Widget A",
      "subtext": "SKU: WDG-001 | $29.99",
      "metadata": { "price": 29.99 }
    }
  ]
}
```

### Tech Stack
- React 18 with TypeScript
- Vite for build tooling
- Tailwind CSS for styling
- React Router v7 for navigation
- React Query for data fetching
- Existing ThemeContext for dark mode

## Integration Notes
- **Depends on:** octocat-supply-api search endpoint must be implemented first
- **Provides:** Reusable search component for app-wide use
- **Integrates with:** Existing navigation, routing, and theme systems

## Acceptance Criteria
- [ ] SearchAutoComplete component implemented
- [ ] Debounced API calls working (300ms delay)
- [ ] Keyboard navigation fully functional
- [ ] Mouse interaction working (hover, click)
- [ ] Accessibility requirements met (ARIA, keyboard-only)
- [ ] Dark mode support verified
- [ ] Responsive design tested on mobile, tablet, desktop
- [ ] Empty state and loading state working
- [ ] Navigation on selection working correctly
- [ ] Performance: < 500ms time to first suggestion
- [ ] Unit tests for component behavior
- [ ] No console errors or warnings

## Testing Checklist
- [ ] Type < 3 characters ‚Üí no API call
- [ ] Type >= 3 characters ‚Üí API call after 300ms
- [ ] Arrow keys navigate suggestions
- [ ] Enter selects highlighted suggestion
- [ ] Escape closes dropdown
- [ ] Click selects suggestion
- [ ] Loading indicator appears during fetch
- [ ] Empty state appears when no results
- [ ] Dark mode styling works
- [ ] Mobile touch interactions work
- [ ] Keyboard-only navigation works
- [ ] Screen reader announces results

## Reference Documentation
- Full specification: `/specs/features/search-autocomplete-page.md` (Phase 2)
- Orchestration plan: `/specs/features/search-autocomplete-orchestration-plan.md`
- Frontend instructions: `/.github/instructions/frontend.instructions.md`

---
*Auto-generated by Copilot multi-repo orchestration*
```

---

## Usage Instructions

When spawning issues:

1. Replace `<ISSUE_NUMBER>` with the actual master issue number
2. Use the exact title format for consistent linking
3. Assign @copilot to each created issue
4. Label appropriately:
   - API issue: `backend`, `api`, `enhancement`
   - Frontend issue: `frontend`, `ui`, `enhancement`
5. Link issues back to master issue in the body

## Integration Order

**Important:** The backend API must be implemented and deployed before the frontend can integrate.

1. ‚úÖ First: octocat-supply-api (no dependencies)
2. ‚è≥ Second: octocat-supply-web (depends on API endpoint)
